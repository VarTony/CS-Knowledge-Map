# Предварительная подгрузка и буферизация данных при работе с дисками

Доступ к диску остаётся самым медленным звеном в вычислительной системе,  
поэтому при обработке больших объёмов данных важно свести к минимуму количество физических обращений.  

Для этого используются **предварительная подгрузка (prefetching)** и **буферизация данных (buffering)** —  
приёмы, позволяющие читать и записывать данные крупными блоками, а не мелкими порциями.

---

## Суть идеи

Вместо того чтобы обращаться к диску каждый раз при необходимости прочитать или записать небольшой участок данных,  
система заранее подгружает **крупные последовательные блоки** в оперативную память  
и сохраняет результаты работы во **временные буферы**, которые сбрасываются на диск  
только по мере накопления достаточного объёма.

Такой подход уменьшает количество обращений к физическому носителю  
и превращает случайные операции ввода-вывода в последовательные.

---

## Пример работы при чтении (вторая фаза TPMMS)

Во второй фазе алгоритма **TPMMS (Two-Phase Multiway Merge Sort)**  
выполняется слияние нескольких отсортированных чанков (run’ов), лежащих на диске.

Чтобы ускорить процесс:

- с каждого run’а подгружается крупный блок данных (например, объёмом с целый цилиндр);  
- из этого блока данные по частям передаются в мелкие оперативные буферы, с которыми работает алгоритм слияния;  
- пока одни буферы обрабатываются, в фоне подгружаются новые блоки —  
  так чтение и вычисления **перекрываются во времени**.

**Результат:** почти полное устранение простоев из-за ожидания диска  
и переход к постоянному потоку данных в памяти.

---

## Буферизация при записи

Аналогичный приём применяется и для **ускорения записи**.  

Вместо того чтобы записывать данные на диск при каждом изменении,  
система хранит их во **временных буферах в ОЗУ**.  

Когда один буфер заполняется, его содержимое сбрасывается на диск,  
а в это время используется следующий буфер.

Таким образом:

1. Запись группируется в крупные последовательные блоки;  
2. Снижается число обращений к диску;  
3. Повышается скорость работы и снижается износ устройства  
   (особенно актуально для SSD).

---

## Почему это эффективно

- **Минимизация seek time и latency.**  
  Все операции чтения и записи становятся последовательными, а значит — максимально быстрыми.

- **Перекрытие ввода-вывода и вычислений.**  
  Пока CPU работает с одним буфером, другой читается или записывается в фоне.

- **Оптимизация для многопутевых операций.**  
  При слиянии десятков файлов или потоков дисковая активность сглаживается,  
  а задержки компенсируются за счёт буферов.

---

## Итог

**Предварительная подгрузка и буферизация** — это фундаментальные техники оптимизации ввода-вывода.  
Они позволяют выравнивать скорость между медленным диском и быстрой оперативной памятью,  
превращая множество мелких обращений в несколько крупных, последовательных операций.

Благодаря этому алгоритмы вроде **TPMMS** выполняются в разы быстрее,  
а сама система остаётся устойчивой даже при работе с объёмами данных,  
многократно превышающими объём ОЗУ.

---

### Связанные темы

- [Геометрия пластин и цилиндров](./DiskGeometry.md)  
- [Алгоритм лифта (SCAN)](../IO_Scheduling/Elevator_SCAN.md)  
- [Буферизация и кэширование на уровне контроллера](./Caching_and_Buffering.md)  
- [Внешние сортировки и TPMMS](../../Algorithms/TPMMS.md)
