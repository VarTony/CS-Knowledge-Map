# Сигнальные биты и контрольные суммы в кодировании данных

Даже в пределах одного сектора надёжность хранения обеспечивается не только физическим качеством поверхности,  
но и встроенными средствами самопроверки.  
Простейший приём обнаружения ошибок — добавление **сигнальных битов (битов чётности)** и **контрольных сумм**,  
которые позволяют определить, были ли искажены отдельные биты при чтении или записи.

---

## Суть идеи

Данные перед записью кодируются с добавлением дополнительных битов, вычисляемых по заранее известному правилу.  
После чтения контроллер снова считает эти биты и сравнивает с ожидаемыми —  
если они не совпадают, значит, в секторе произошла ошибка.

---

## Бит чётности (Parity bit)

Один из самых старых и простых способов.  
Для каждого байта данных вычисляется количество единиц (битов со значением 1):

- если число чётное, сигнальный бит ставится в `0`;  
- если нечётное, ставится `1`.

**Пример:**
```
10001011 → 4 единицы (чётное) → бит чётности = 0
00100011 → 3 единицы (нечётное) → бит чётности = 1
```

При чтении контроллер пересчитывает количество единиц, сравнивает с битом чётности  
и фиксирует ошибку, если они не согласуются.  

Метод способен **обнаружить одиночную ошибку**, но не исправить её.

---

## Расширенные схемы чётности

Чтобы повысить надёжность, добавляют несколько битов чётности,  
каждый из которых отвечает не за весь байт, а за его часть (например, по 4 бита).  
Таким образом можно не только обнаружить ошибку, но и определить, **в каком бите она произошла**.  

Эта идея легла в основу **кодов Хэмминга**,  
где добавочные биты строятся по логической матрице зависимостей  
и позволяют даже **восстанавливать искажённый бит**.

---

## Контрольные суммы

Контрольная сумма — это более общий и гибкий способ проверки целостности блока данных, чем бит чётности.  
Она вычисляется как **числовая функция от всех байтов сектора**.  

Самый простой вариант — арифметическая сумма всех байтов по модулю 256 (или другого основания),  
но чаще применяются более сложные алгоритмы, устойчивые к множественным ошибкам.

---

### 1. Simple checksum (mod N)

Все байты складываются, и результат усекляется по модулю.  
При чтении выполняется то же сложение, и сумма должна совпасть с записанной.  
Ошибки одного бита почти всегда изменяют результат.

---

### 2. CRC (Cyclic Redundancy Check)

Здесь данные интерпретируются как многочлен,  
который делится по модулю на заранее выбранный **контрольный многочлен**.  

Остаток от деления (несколько байт) и есть контрольная сумма CRC.  

Метод способен уверенно обнаруживать:

- одиночные и двойные ошибки,  
- ошибки в непрерывных группах битов,  
- и большинство случайных комбинаций.  

CRC широко применяется в **сетевых протоколах**, **файловых системах** и  
низкоуровневых форматах хранения (например, `CRC32`, `CRC64`).

---

### 3. Хеш-суммы (MD5, SHA)

Используются уже не в секторах, а на более высоких уровнях хранения —  
например, в СУБД или системах резервного копирования.  

Они дают более надёжный контроль на уровне мегабайт и гигабайт данных.

---

## Как это работает на практике

Перед записью данные проходят через алгоритм расчёта контрольной суммы (или CRC).  
Сумма добавляется в конец сектора — в служебную область.  

При чтении контроллер заново вычисляет сумму с тех же данных.  
Если результат совпадает — сектор считается корректным.  
Несовпадение — сигнал ошибки: сектор перечитывается или ремаппируется.  

Таким образом, контрольная сумма служит **подписью содержимого сектора** —  
любое изменение даже одного бита нарушает эту подпись.

---

## Итог

**Сигнальные биты и контрольные суммы** — это базовые элементы системы защиты данных от случайных ошибок.  

- Биты чётности обеспечивают простую локальную проверку.  
- Контрольные суммы и CRC позволяют контроллеру выявлять сложные и множественные искажения.  

Благодаря этим механизмам диск способен **самостоятельно определять**,  
когда сектор прочитан неверно, и предпринимать шаги для восстановления или ремаппинга данных.

---

### Связанные темы

- [Ремаппинг и резервирование секторов](../Redundancy/Remapping_and_SectorSparing.md)  
- [Побитовое суммирование и XOR-паритет](../Redundancy/Parity_and_XOR.md)  
- [Коды Хэмминга и коррекция ошибок](../FaultTolerance/ErrorCorrection.md)  
- [Отказоустойчивость и MTTDL](../FaultTolerance/MTBF_and_MTTDL.md)


