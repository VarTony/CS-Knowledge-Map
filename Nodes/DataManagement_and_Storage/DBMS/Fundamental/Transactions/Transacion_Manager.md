---
title: Менеджер транзакций и связь с ACID
---

# Менеджер транзакций: ядро согласованности и координации ACID

Современные реляционные СУБД построены по модульному принципу. Каждая операция с данными проходит через набор специализированных компонентов — **менеджеров**, которые в совокупности обеспечивают выполнение свойств **ACID**, то есть гарантируют, что транзакции исполняются предсказуемо, изолированно и без потери данных.

Центральное место в этой архитектуре занимает **менеджер транзакций**. Он не выполняет запросы напрямую, а **координирует** другие подсистемы: отправляет команды процессору запросов, контролирует работу менеджера буферов, инициирует протоколирование и принимает решения о фиксации или откате транзакции.

---

## Архитектура взаимодействия менеджеров

```

Процессор
запросов  ←→  Менеджер транзакций  →  Менеджер протоколирования
↘               ↓                     ↘
→      Менеджер буферов      ←→  Менеджер восстановления
↓
Данные / Протокол (диск)

```

---

## Роли ключевых менеджеров

### Менеджер транзакций — координатор
* Запускает транзакцию, управляет её состоянием.
* Передаёт запросы процессору запросов.
* Контролирует фиксацию (COMMIT) и откат (ROLLBACK).
* Отвечает за согласованность (Consistency) и оформление границ транзакции (Atomicity).

---

### Процессор запросов (Query Processor)
* Выполняет SQL-команды, оптимизирует планы выполнения.
* Работает не напрямую с диском, а с копиями данных, полученными через менеджер буферов.
* Получает слепок данных (snapshot) от менеджера транзакций в зависимости от уровня изоляции.

---

### Менеджер буферов (Buffer Manager)
* Управляет страницами памяти.
* Решает, когда загружать блоки с диска и когда сбрасывать изменённые данные.
* Является "точкой контакта" между оперативной памятью и диском.

---

### Менеджер протоколирования (Logging Manager)
* Записывает в журнал все изменения **до** их фактического применения.
* Реализует концепцию *Write-Ahead Log (WAL)*.
* Гарантирует атомарность и устойчивость: если данные записаны в журнал — транзакция не потеряется.

---

### ♻ Менеджер восстановления (Recovery Manager)
* Срабатывает при сбоях.
* Читает журнал и принимает решение:
  - **REDO** — повторить завершённую транзакцию, если изменения не дошли до диска.
  - **UNDO** — откатить незавершённую транзакцию.

---

## Связь менеджеров и ACID

| Компонент                   | Свойства ACID                                 | Роль в обеспечении                                                                 |
|---------------------------|-----------------------------------------------|-------------------------------------------------------------------------------------|
| **Менеджер транзакций**  | A (Atomicity), C (Consistency), I (Isolation)  | Контроль начала/завершения транзакции; проверка согласованности; формирование snapshot-контекста и передача его в Менеджер запросов |
| **Менеджер протоколирования** | A (Atomicity), D (Durability, совместно с менеджером восстановления) | Запись операций в WAL до физического применения; обеспечивает возможность как отката (UNDO), так и повторного применения (REDO) |
| **Менеджер буферов**     | косвенно D (Durability)                       | Удерживает изменённые блоки в памяти до момента фиксации; управляет "грязными страницами" |
| **Менеджер восстановления** | A (Atomicity), D (Durability)               | При сбое анализирует WAL; выполняет REDO для завершённых транзакций и UNDO для незавершённых |
| **Менеджер запросов**   | косвенно I (Isolation)                         | Исполняет SQL в рамках заданного snapshot или блокировок, не управляет изоляцией, а следует ей |

---

## Свойства ACID и механизм их реализации

### **Atomicity (Атомарность)**
* Гарантируется связкой: **Менеджер транзакций + Менеджер протоколирования + Менеджер восстановления**.
* Если транзакция не завершена — все её эффекты отменяются через UNDO.

### **Consistency (Согласованность)**
* Обеспечивается **Менеджером транзакций** через проверку констрейнов и корректности состояния перед COMMIT.
* Нарушение согласованности делает транзакцию невозможной к фиксации.

### **Isolation (Изолированность)**
* Реализуется на уровне **Менеджера транзакций**, который создаёт контекст выполнения (snapshot или блокировку).
* **Менеджер запросов** просто выполняет транзакцию в рамках предоставленного контекста.

### **Durability (Устойчивость)**
* Обеспечивается связкой: **Менеджер протоколирования (WAL)** + **Менеджер восстановления**.
* После COMMIT данные считаются сохранёнными, так как WAL гарантирует восстановление даже после сбоя.

---

## Итог

Менеджер транзакций — это **оркестратор**, который:
* запускает и завершает транзакции,
* взаимодействует с каждым менеджером,
* гарантирует выполнение ACID на системном уровне.

 Каждое из свойств реализуется **конкретными компонентами архитектуры**. Вместе эти компоненты создают механизм, благодаря которому реляционно подобные СУБД остаются надежным фундаментом критически важных систем.

---

## Связанные темы

- [MVCC и уровни изоляции транзакций](./MVCC_Isolation.md)
- [Протокол WAL и методы REDO/UNDO](./Logging_and_Recovery.md)
- [Буферный менеджер и архитектура памяти](./Buffer_Manager.md)
```
