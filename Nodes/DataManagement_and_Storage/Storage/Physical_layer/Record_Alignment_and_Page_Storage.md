---
title: Размещение и выравнивание записей в блоках СУБД
description: Принципы организации записей внутри страниц хранения, выравнивание данных и ограничения на пересечение границ страниц.
tags:
  - dbms
  - physical_storage
  - record_alignment
  - page_structure
---

# Размещение и выравнивание записей в блоках СУБД

## Общие принципы

В системах управления базами данных (СУБД) данные хранятся в виде **записей (кортежей)**, объединённых в **страницы** или **блоки фиксированного размера** — как правило, **8 КБ**.  
Страница является минимальной единицей ввода-вывода: при обращении к диску всегда читается или записывается целиком.

Записи могут иметь как **постоянную**, так и **переменную длину**, но каждая из них должна **целиком помещаться в одну страницу**.  
СУБД не допускает пересечения границ страниц — принцип *no cross-page tuples*.  
Это упрощает адресацию и ускоряет доступ к данным.

--

## Структура записи

Каждая запись состоит из **заголовка** и **данных полей**.

**Заголовок** содержит служебную информацию:
- указатель на схему (описание структуры таблицы);
- длину записи;
- отметку времени вставки или обновления.

Далее следуют **поля пользователя**, выровненные по границам машинного слова (обычно 4 или 8 байт) для ускорения доступа.  
Если тип данных не кратен границе выравнивания, в структуру добавляются **дополнительные байты-пустышки (padding)**.

```
┌──────────────────────────────────────────────────────────┐
│ Заголовок (12 байт) │ name │ address │ gender │ birthdate│
│  0…11                │12…43 │44…299  │300…303 │304…315   │
└──────────────────────────────────────────────────────────┘
Общий размер записи — 316 байт
```

--

## Группировка записей в блоках

Несколько записей размещаются последовательно внутри блока (страницы).  
Каждый блок содержит:

- заголовок страницы (Page Header);
- таблицу смещений (**line pointers**), указывающих, где в странице начинается каждая запись;
- сами записи;
- свободное пространство для новых вставок.

```
┌──────────────────────────────────────────────┐
│ Заголовок страницы                           │
│ Таблица указателей (Line Pointer Array)      │
│ Запись 1                                     │
│ Запись 2                                     │
│ ...                                          │
│ Свободное место                              │
└──────────────────────────────────────────────┘
```

Если новая запись **не помещается целиком**, СУБД переносит её **на следующую страницу**,  
даже если в текущей осталось немного свободного места.  
Это предотвращает пересечение границ страниц и упрощает работу индексов и WAL-журналирования.

--

## Выравнивание и производительность

Причины выравнивания данных внутри страницы:

1. **Эффективность процессора.**  
   Современные CPU читают память блоками (по 4–8 байт).  
   Если данные не выровнены, процессор вынужден загружать два блока и объединять их.

2. **Простота адресации.**  
   Выровненные поля начинаются по предсказуемым смещениям.

3. **Минимизация кэш-промахов.**  
   Выровненные структуры эффективнее кэшируются и реже вызывают дополнительные обращения к памяти.

4. **Предсказуемость размера записи.**  
   Для записей постоянной длины СУБД легко вычисляет позицию записи `n` в блоке — `offset = n * record_size`.

--

## Управление свободным пространством

Если после размещения записей остаются небольшие «дырки» (например, 12–20 байт),  
СУБД **не перемещает данные для уплотнения**, чтобы не нарушить MVCC.  
Эти байты помечаются как **свободные** в *Free Space Map* и могут быть использованы позже для коротких записей или указателей.

---

## Итог

| Принцип | Смысл |
|----------|--------|
| Страница — минимальная единица I/O | Все операции чтения и записи выполняются целыми страницами |
| Запись не пересекает границы страницы | Простая адресация и надёжность |
| Поля выровнены по границам слова | Быстрее чтение и меньше кэш-промахов |
| Padding-байты | Компенсируют несовпадение размеров типов |
| Небольшие «дырки» | Учитываются в Free Space Map для дальнейшего использования |

---

### Связанные темы

- [Геометрия пластин и цилиндров](./DiskGeometry.md)
- [Предварительная подгрузка и буферизация данных](./Prefetching_and_Buffering.md)  
- [WAL и атомарность страниц](/Nodes/DataManagement_and_Storage/Storage/FaultTolerance/WAL_and_Page_Atomicity.md)  
- [TOAST — хранение больших атрибутов](/Nodes/DataManagement_and_Storage/DBMS/Storage/TOAST_and_External_Storage.md)
