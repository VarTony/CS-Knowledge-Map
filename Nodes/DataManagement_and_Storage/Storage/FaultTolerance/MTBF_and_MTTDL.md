# Отказоустойчивость и надёжность систем хранения  
## MTBF и MTTDL

**Отказоустойчивость (Fault tolerance)** — это способность системы продолжать работу  
даже при выходе из строя отдельных её компонентов: дисков, контроллеров, узлов.  

Для оценки надёжности применяются две ключевые метрики — **MTBF** и **MTTDL**,  
которые позволяют количественно описать, как долго система может функционировать без потери данных.

---

## MTBF — *Mean Time Between Failures*

**MTBF** — среднее время между отказами отдельного устройства.  
Это статистическая характеристика, показывающая,  
через какой промежуток времени в среднем происходит сбой.

**Пример:**
- HDD с MTBF = 1 000 000 часов  
  означает, что вероятность отказа ≈ 1 за 1 млн часов работы,  
  но не гарантирует, что конкретный диск проработает столько времени.

**Формула:**
```
MTBF = Общее время работы / Количество отказов
```


**Особенности:**
- Применяется к отдельным устройствам (HDD, SSD, контроллерам).
- Не учитывает избыточность и восстановление.
- Используется для оценки надёжности компонентов, а не массивов.

---

## MTTF — *Mean Time To Failure*

Похожая метрика, но без предполагаемого ремонта.  
**MTTF** используется для **невосстанавливаемых** устройств  
(например, однократно используемых компонентов, датчиков, лент).

---

## MTTDL — *Mean Time To Data Loss*

**MTTDL** — среднее время до потери данных во всей системе хранения.  
В отличие от MTBF, учитывает:
- наличие зеркалирования, паритета, резервирования;
- время восстановления отказавшего диска;
- вероятность множественных отказов за период восстановления.

### Пример:

Для массива RAID 1 из двух дисков:
```
MTTDL ≈ (MTBF^2) / (2 × MTTR)
```
где  
**MTTR (Mean Time To Repair)** — среднее время на замену и восстановление данных.

Если MTBF каждого диска = 1 000 000 ч, а MTTR = 10 ч:
```
MTTDL ≈ (1e6)^2 / (2 × 10) = 5 × 10^10 ч
≈ 5.7 миллионов лет
```
На практике MTTDL уменьшается при росте числа дисков —  
чем больше устройств, тем выше вероятность, что несколько выйдут из строя одновременно.

---

## Как повышают отказоустойчивость

1. **Зеркалирование (Mirroring)**  
   — данные дублируются на нескольких дисках.  
   Отказ одного диска не приводит к потере данных.

2. **Паритет и кодирование (Parity, XOR, Reed–Solomon)**  
   — сохраняется возможность восстановления утраченных блоков.  
   Используется в RAID 5/6, Ceph, ZFS.

3. **Горячие резервы (Hot Spare)**  
   — запасные диски автоматически берут на себя роль вышедших из строя.

4. **Мониторинг и прогнозирование отказов**  
   — SMART, анализ ошибок чтения/записи, температура, вибрации.

5. **Сокращение MTTR**  
   — автоматическое восстановление, фоновые реконструкции данных,  
     репликации в кластерах, мгновенные снимки (snapshots).

---

## Связь между метриками

| Метрика | Описание | Применение |
|----------|-----------|-------------|
| **MTBF** | Среднее время между отказами | Для отдельного устройства |
| **MTTF** | Среднее время до отказа (без ремонта) | Для невосстанавливаемых элементов |
| **MTTR** | Среднее время восстановления | Для сервисных оценок |
| **MTTDL** | Среднее время до потери данных | Для массивов и систем хранения |

---

## Интуитивно

- MTBF показывает **надежность компонента**.  
- MTTDL показывает **надёжность всей системы**.  
  Даже если каждый диск надёжен, массив из десятков дисков имеет меньший MTTDL.  
- Главное влияние — **скорость восстановления (MTTR)**:  
  чем быстрее перестраивается массив, тем меньше шанс потерять данные при двойном отказе.

---

## Итог

Понимание метрик **MTBF** и **MTTDL** позволяет проектировать  
баланс между надёжностью, скоростью и стоимостью.  

- Высокий MTBF → меньше вероятность одиночного сбоя.  
- Низкий MTTR → меньше окно уязвимости для двойных отказов.  
- Высокий MTTDL → система выдерживает больше катастроф без потери данных.

Отказоустойчивость — это не отсутствие ошибок,  
а способность **системы жить дольше, чем её отдельные части.**

---

### Связанные темы

- [Зеркалирование данных](../Reliability/Mirroring.md)  
- [Страйпинг данных](../Reliability/Striping.md)  
- [Основные уровни RAID (0–6)](../Reliability/RAID_Levels.md)  
- [Побитовое суммирование и XOR-паритет](../Reliability/Parity_and_XOR.md)  
- [Ремаппинг и резервирование секторов](../Reliability/Remapping_and_SectorSparing.md)
